<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Autism Spectrum Prediction Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { border: none; border-radius: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .live-data-card { background-color: #ffffff; border-left: 5px solid #0d6efd; }
        .form-label { font-weight: 600; color: #495057; font-size: 0.9rem; }
        .form-select, .form-control { border-radius: 0.5rem; padding: 0.75rem; border: 1px solid #ced4da; }
        .form-select:focus, .form-control:focus { border-color: #86b7fe; box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); }
        .section-title { font-size: 1.1rem; color: #0d6efd; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; margin-bottom: 20px; font-weight: bold; }
        #predictionResult { font-size: 1.1rem; white-space: pre-wrap; line-height: 1.6; }
        .btn-primary { background-color: #0d6efd; border: none; border-radius: 0.5rem; font-weight: 600; letter-spacing: 0.5px; }
    </style>
</head>
<body>
<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold text-dark">Autism Screening Dashboard</h1>
        <p class="lead text-muted">AI-powered assessment using behavioural and demographic data.</p>
    </div>

    <div class="row g-4">
        <!-- FORM COLUMN -->
        <div class="col-lg-8">
            <div class="card h-100">
                <div class="card-body p-4 p-md-5">
                    <form id="predictionForm">
                        
                        <!-- SECTION 1: BEHAVIOURAL QUESTIONS -->
                        <div class="section-title">üìä Behavioural Questions (A1-A10)</div>
                        <p class="text-muted small mb-3">Defaults set to <strong>High Risk</strong> profile (Score 10/10) to test Positive prediction.</p>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="A1" class="form-label">A1: Does child look at you when called?</label>
                                <select id="A1" class="form-select">
                                    <option value="0">Yes (Typical)</option>
                                    <option value="1" selected>No (Atypical)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="A2" class="form-label">A2: Easy to get eye contact?</label>
                                <select id="A2" class="form-select">
                                    <option value="0">Easy (Typical)</option>
                                    <option value="1" selected>Difficult (Atypical)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="A3" class="form-label">A3: Points to indicate interest?</label>
                                <select id="A3" class="form-select">
                                    <option value="0">Yes (Typical)</option>
                                    <option value="1" selected>No (Atypical)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="A4" class="form-label">A4: Points to share interest?</label>
                                <select id="A4" class="form-select">
                                    <option value="0">Yes (Typical)</option>
                                    <option value="1" selected>No (Atypical)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="A5" class="form-label">A5: Pretend play?</label>
                                <select id="A5" class="form-select">
                                    <option value="0">Yes (Typical)</option>
                                    <option value="1" selected>No (Atypical)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="A6" class="form-label">A6: Follows your gaze?</label>
                                <select id="A6" class="form-select">
                                    <option value="0">Yes (Typical)</option>
                                    <option value="1" selected>No (Atypical)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="A7" class="form-label">A7: Comforts you if upset?</label>
                                <select id="A7" class="form-select">
                                    <option value="0">Yes (Typical)</option>
                                    <option value="1" selected>No (Atypical)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="A8" class="form-label">A8: First words / Speaking?</label>
                                <select id="A8" class="form-select">
                                    <option value="0">Typical</option>
                                    <option value="1" selected>Delayed/Atypical</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="A9" class="form-label">A9: Brings objects to show?</label>
                                <select id="A9" class="form-select">
                                    <option value="0">Yes (Typical)</option>
                                    <option value="1" selected>No (Atypical)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="A10" class="form-label">A10: Stares at nothing?</label>
                                <select id="A10" class="form-select">
                                    <option value="0">No (Typical)</option>
                                    <option value="1" selected>Yes (Atypical)</option>
                                </select>
                            </div>
                        </div>

                        <!-- SECTION 2: DEMOGRAPHICS & MEDICAL -->
                        <div class="section-title mt-4">üë§ Demographics & Medical History</div>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="Age_Years" class="form-label">Age (Years)</label>
                                <input type="number" id="Age_Years" class="form-control" value="2" min="1" max="18">
                            </div>
                            <div class="col-md-4">
                                <label for="Sex" class="form-label">Sex</label>
                                <select id="Sex" class="form-select">
                                    <option value="1" selected>Male</option> 
                                    <option value="0">Female</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="Ethnicity" class="form-label">Ethnicity</label>
                                <select id="Ethnicity" class="form-select">
                                    <option value="0" selected>Asian</option>
                                    <option value="1">Black</option>
                                    <option value="2">Hispanic</option>
                                    <option value="3">Middle Eastern</option>
                                    <option value="4">Native Indian</option>
                                    <option value="5">Others</option>
                                    <option value="6">South Asian</option>
                                    <option value="7">White European</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="Jaundice" class="form-label">Born with Jaundice?</label>
                                <select id="Jaundice" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1" selected>Yes</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="Family_mem_with_ASD" class="form-label">Family Member with ASD?</label>
                                <select id="Family_mem_with_ASD" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1" selected>Yes</option>
                                </select>
                            </div>
                        </div>

                        <!-- SECTION 3: OTHER CONDITIONS -->
                        <div class="section-title mt-4">üè• Additional Screening</div>
                        <div class="row g-3">
                             <div class="col-md-4">
                                <label for="Depression" class="form-label">Depression Diagnosed?</label>
                                <select id="Depression" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1" selected>Yes</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="Anxiety_disorder" class="form-label">Anxiety Disorder?</label>
                                <select id="Anxiety_disorder" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1" selected>Yes</option>
                                </select>
                            </div>
                             <div class="col-md-4">
                                <label for="Who_completed_the_test" class="form-label">Who completed test?</label>
                                <select id="Who_completed_the_test" class="form-select">
                                    <option value="0" selected>Family Member</option>
                                    <option value="1">Health Care Professional</option>
                                    <option value="2">Others</option>
                                    <option value="3">Self</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mt-5 p-3 shadow-sm">
                            üîç Generate Prediction Report
                        </button>
                    
                        <div id="predictionResult" class="mt-4 p-3 rounded d-none"></div>
                    </form>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: LIVE DATA & IMAGE LINK -->
        <div class="col-lg-4">
             <a class="btn btn-outline-primary w-100 mb-4 p-3 fw-bold" href="http://localhost:8501" target="_blank">
                üì∑ Switch to Image Analysis (Streamlit)
            </a>

            <div class="card live-data-card">
                 <div class="card-body p-4">
                    <h5 class="card-title text-center mb-3">üì° Live IoT Sensor Data</h5>
                    <div id="sensorStatus" class="text-center badge bg-secondary w-100 mb-3 p-2">
                        Connecting...
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-2 border-bottom pb-2">
                        <span>Repetitive Motion:</span>
                        <span id="repetitiveStatus" class="fw-bold text-primary">--</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>Heart Rate:</span>
                        <span id="movementEnergy" class="fw-bold text-success">--</span>
                    </div>

                    <button id="fetchToday" class="btn btn-outline-primary w-100 mb-2">
                        üìÖ Show Today's Monitoring Summary
                    </button>
                    <div id="todaySummary" class="mt-2 small text-center text-muted">
                        No summary loaded yet.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    // --- Live Sensor Update Logic ---
    async function updateDashboard() {
        try {
            const res = await axios.get("/api/data");
            const data = res.data;
            const statusEl = document.getElementById('sensorStatus');
            
            if (!data || data.length === 0) { 
                statusEl.textContent = 'Waiting for Device...';
                statusEl.className = 'text-center badge bg-warning w-100 mb-3 p-2 text-dark';
                document.getElementById("repetitiveStatus").textContent = "--";
                document.getElementById("movementEnergy").textContent = "--";
                return; 
            }
            
            statusEl.textContent = 'üü¢ Device Connected';
            statusEl.className = 'text-center badge bg-success w-100 mb-3 p-2';
            
            const latestData = data[data.length - 1];

            // Repetitive Motion from backend
            const isRepetitive = latestData.repetitive;
            document.getElementById('repetitiveStatus').textContent =
                isRepetitive ? 'YES' : 'NO';
            
            // Heart Rate view: High / Normal / 0
            const bpm = latestData.bpm;

            if (bpm === 0 || bpm === undefined) {
                document.getElementById("movementEnergy").textContent = "0";
            } 
            else {
                document.getElementById("movementEnergy").textContent =
                    bpm > 80 ? "High" : "Normal";
            }

        } catch (err) {
            const statusEl = document.getElementById('sensorStatus');
            statusEl.textContent = 'üî¥ Offline';
            statusEl.className = 'text-center badge bg-danger w-100 mb-3 p-2';
            document.getElementById("repetitiveStatus").textContent = "--";
            document.getElementById("movementEnergy").textContent = "--";
        }
    }
    setInterval(updateDashboard, 2000);
    updateDashboard();

    // --- Today's Summary Logic ---
    document.getElementById("fetchToday").addEventListener("click", async () => {
        const box = document.getElementById("todaySummary");
        box.innerHTML = "‚è≥ Loading today's report...";

        try {
            const res = await axios.get("/api/today-summary");
            const { avg_bpm, dominant_bpm_status, dominant_repetitive } = res.data;

            box.innerHTML = `
                <div class="p-2 mt-2 bg-light rounded border">
                    ‚ù§Ô∏è Avg Heart Rate: <b>${avg_bpm ? avg_bpm.toFixed(1) : "--"} BPM</b><br>
                    üíì Dominant HR Status: <b>${dominant_bpm_status}</b><br>
                    üîÅ Repetitive Motion: <b>${dominant_repetitive}</b>
                </div>
            `;
        } catch (error) {
            console.error(error);
            box.innerHTML = "‚ùå Error loading summary";
        }
    });

    // --- Form Submission Logic (same as before) ---
    document.getElementById('predictionForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const resultDiv = document.getElementById('predictionResult');
        resultDiv.classList.remove('d-none', 'bg-success-subtle', 'bg-danger-subtle', 'text-success-emphasis', 'text-danger-emphasis');
        resultDiv.classList.add('bg-info-subtle', 'text-info-emphasis');
        resultDiv.textContent = '‚è≥ Processing data with AI Model...';

        const questions = ['A1', 'A2', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'A9', 'A10'];
        let qChatTotal = 0;
        let questionValues = {};

        questions.forEach(q => {
            const val = parseInt(document.getElementById(q).value);
            questionValues[q] = val;
            qChatTotal += val;
        });

        const formData = {
            ...questionValues,
            'A10_Autism_Spectrum_Quotient': questionValues['A10'],
            'Qchat_10_Score': qChatTotal,
            'Age_Years': parseInt(document.getElementById('Age_Years').value) || 0,
            'Sex': parseInt(document.getElementById('Sex').value),
            'Ethnicity': parseInt(document.getElementById('Ethnicity').value),
            'Jaundice': parseInt(document.getElementById('Jaundice').value),
            'Family_mem_with_ASD': parseInt(document.getElementById('Family_mem_with_ASD').value),
            'Depression': parseInt(document.getElementById('Depression').value),
            'Anxiety_disorder': parseInt(document.getElementById('Anxiety_disorder').value),
            'Who_completed_the_test': parseInt(document.getElementById('Who_completed_the_test').value)
        };

        console.log("Sending Data:", formData);

        try {
            const res = await axios.post('/predict', formData);
            resultDiv.classList.remove('bg-info-subtle', 'text-info-emphasis');
            resultDiv.classList.add('bg-success-subtle', 'text-success-emphasis');
            resultDiv.textContent = res.data.prediction;
        } catch (err) {
            console.error(err);
            resultDiv.classList.remove('bg-info-subtle', 'text-info-emphasis');
            resultDiv.classList.add('bg-danger-subtle', 'text-danger-emphasis');
            resultDiv.textContent = 'Error: ' + (err.response?.data?.error || err.message);
        }
    });
</script>
</body>
</html>




<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Autism Spectrum Prediction Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { border: none; border-radius: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .live-data-card { background-color: #ffffff; border-left: 5px solid #0d6efd; }
        .form-label { font-weight: 600; color: #495057; font-size: 0.9rem; }
        .form-select, .form-control { border-radius: 0.5rem; padding: 0.75rem; border: 1px solid #ced4da; }
        .form-select:focus, .form-control:focus { border-color: #86b7fe; box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); }
        .section-title { font-size: 1.1rem; color: #0d6efd; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; margin-bottom: 20px; font-weight: bold; }
        #predictionResult { font-size: 1.1rem; white-space: pre-wrap; line-height: 1.6; }
        .btn-primary { background-color: #0d6efd; border: none; border-radius: 0.5rem; font-weight: 600; letter-spacing: 0.5px; }
    </style>
</head>
<body>
<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold text-dark">Autism Screening Dashboard</h1>
        <p class="lead text-muted">AI-powered assessment using behavioural and demographic data.</p>
    </div>

    <div class="row g-4">

        <div class="col-lg-8">
            <div class="card h-100">
                <div class="card-body p-4 p-md-5">
                    <form id="predictionForm">
                        

                        <div class="section-title">üìä Behavioural Questions (A1-A10)</div>
                        <p class="text-muted small mb-3">Please select <strong>1</strong> if the behavior is a symptom/atypical, or <strong>0</strong> if typical. (Based on your dataset values)</p>
                        
                        <div class="row g-3">
                            <div class="col-md-6"><label for="A1" class="form-label">A1: Does child look at you when called?</label><select id="A1" class="form-select"><option value="0">Yes (Typical)</option><option value="1">No (Atypical)</option></select></div>
                            <div class="col-md-6"><label for="A2" class="form-label">A2: Easy to get eye contact?</label><select id="A2" class="form-select"><option value="0">Easy (Typical)</option><option value="1">Difficult (Atypical)</option></select></div>
                            <div class="col-md-6"><label for="A3" class="form-label">A3: Points to indicate interest?</label><select id="A3" class="form-select"><option value="0">Yes (Typical)</option><option value="1">No (Atypical)</option></select></div>
                            <div class="col-md-6"><label for="A4" class="form-label">A4: Points to share interest?</label><select id="A4" class="form-select"><option value="0">Yes (Typical)</option><option value="1">No (Atypical)</option></select></div>
                            <div class="col-md-6"><label for="A5" class="form-label">A5: Pretend play?</label><select id="A5" class="form-select"><option value="0">Yes (Typical)</option><option value="1">No (Atypical)</option></select></div>
                            <div class="col-md-6"><label for="A6" class="form-label">A6: Follows your gaze?</label><select id="A6" class="form-select"><option value="0">Yes (Typical)</option><option value="1">No (Atypical)</option></select></div>
                            <div class="col-md-6"><label for="A7" class="form-label">A7: Comforts you if upset?</label><select id="A7" class="form-select"><option value="0">Yes (Typical)</option><option value="1">No (Atypical)</option></select></div>
                            <div class="col-md-6"><label for="A8" class="form-label">A8: First words / Speaking?</label><select id="A8" class="form-select"><option value="0">Typical</option><option value="1">Delayed/Atypical</option></select></div>
                            <div class="col-md-6"><label for="A9" class="form-label">A9: Brings objects to show?</label><select id="A9" class="form-select"><option value="0">Yes (Typical)</option><option value="1">No (Atypical)</option></select></div>
                            <div class="col-md-6"><label for="A10" class="form-label">A10: Stares at nothing?</label><select id="A10" class="form-select"><option value="0">No (Typical)</option><option value="1">Yes (Atypical)</option></select></div>
                        </div>


                        <div class="section-title mt-4">üë§ Demographics & Medical History</div>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="Age_Years" class="form-label">Age (Years)</label>
                                <input type="number" id="Age_Years" class="form-control" value="2" min="1" max="18">
                            </div>
                            <div class="col-md-4">
                                <label for="Sex" class="form-label">Sex</label>
                                <select id="Sex" class="form-select">
                                    <option value="1">Male</option>
                                    <option value="0">Female</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="Ethnicity" class="form-label">Ethnicity</label>

                                <select id="Ethnicity" class="form-select">
                                    <option value="0">White European</option>
                                    <option value="1">Middle Eastern</option>
                                    <option value="2">Asian</option>
                                    <option value="3">Black</option>
                                    <option value="4">Hispanic</option>
                                    <option value="5">South Asian</option>
                                    <option value="6">Native Indian</option>
                                    <option value="7">Others</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="Jaundice" class="form-label">Born with Jaundice?</label>
                                <select id="Jaundice" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1">Yes</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="Family_mem_with_ASD" class="form-label">Family Member with ASD?</label>
                                <select id="Family_mem_with_ASD" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1">Yes</option>
                                </select>
                            </div>
                        </div>


                        <div class="section-title mt-4">üè• Additional Screening</div>
                        <div class="row g-3">
                             <div class="col-md-4">
                                <label for="Depression" class="form-label">Depression Diagnosed?</label>
                                <select id="Depression" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1">Yes</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="Anxiety_disorder" class="form-label">Anxiety Disorder?</label>
                                <select id="Anxiety_disorder" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1">Yes</option>
                                </select>
                            </div>
                             <div class="col-md-4">
                                <label for="Who_completed_the_test" class="form-label">Who completed test?</label>
                                <select id="Who_completed_the_test" class="form-select">
                                    <option value="0">Family Member</option>
                                    <option value="1">Health Care Professional</option>
                                    <option value="2">Self</option>
                                    <option value="3">Others</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mt-5 p-3 shadow-sm">üîç Generate Prediction Report</button>
                    </form>
                    
                    <div id="predictionResult" class="mt-4 p-3 rounded d-none"></div>
                </div>
            </div>
        </div>


        <div class="col-lg-4">
             <a class="btn btn-outline-primary w-100 mb-4 p-3 fw-bold" href="http://localhost:8501" target="_blank">
                üì∑ Switch to Image Analysis (Streamlit)
            </a>

            <div class="card live-data-card">
                 <div class="card-body p-4">
                    <h5 class="card-title text-center mb-4">üì° Live IoT Sensor Data</h5>
                    <div id="sensorStatus" class="text-center badge bg-secondary w-100 mb-3 p-2">Connecting...</div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
                        <span>Repetitive Motion:</span>
                        <span id="repetitiveStatus" class="fw-bold text-primary">--</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Movement Energy:</span>
                        <span id="movementEnergy" class="fw-bold text-success">--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    async function updateDashboard() {
        try {
            const res = await axios.get("/api/data");
            const data = res.data;
            const statusEl = document.getElementById('sensorStatus');
            
            if (data.length === 0) { 
                statusEl.textContent = 'Waiting for Device...';
                statusEl.className = 'text-center badge bg-warning w-100 mb-3 p-2 text-dark';
                return; 
            }
            
            statusEl.textContent = 'üü¢ Device Connected';
            statusEl.className = 'text-center badge bg-success w-100 mb-3 p-2';
            
            const latestData = data[data.length - 1];
            const isRepetitive = latestData.repetitive;
            document.getElementById('repetitiveStatus').textContent = isRepetitive ? 'YES' : 'NO';
            
            const { ax, ay, az } = latestData;
            const energy = Math.sqrt(ax*ax + ay*ay + az*az);
            document.getElementById('movementEnergy').textContent = energy > 25000 ? 'HIGH' : 'LOW';
        } catch (err) {
            const statusEl = document.getElementById('sensorStatus');
            statusEl.textContent = 'üî¥ Offline';
            statusEl.className = 'text-center badge bg-danger w-100 mb-3 p-2';
        }
    }
    setInterval(updateDashboard, 2000);
    updateDashboard();

    // --- Form Submission Logic ---
    document.getElementById('predictionForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const resultDiv = document.getElementById('predictionResult');
        resultDiv.classList.remove('d-none', 'bg-success-subtle', 'bg-danger-subtle', 'text-success-emphasis', 'text-danger-emphasis');
        resultDiv.classList.add('bg-info-subtle', 'text-info-emphasis');
        resultDiv.textContent = '‚è≥ Processing data with AI Model...';

        // 1. Collect A1-A10 values
        const questions = ['A1', 'A2', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'A9', 'A10'];
        let qChatTotal = 0;
        let questionValues = {};

        questions.forEach(q => {
            const val = parseInt(document.getElementById(q).value);
            questionValues[q] = val; // Store raw value (0 or 1)
            qChatTotal += val;       // Sum for Qchat Score
        });

        // 2. Construct Data Payload
        // FIX: Ensure all values are converted to Numbers to avoid "ValueError: could not convert string to float"
        // Also ensure A10_Autism_Spectrum_Quotient is explicitly mapped from A10 or A10_Autism_Spectrum_Quotient logic
        const formData = {
            ...questionValues, // Expands A1: 0, A2: 1, etc.
            'A10_Autism_Spectrum_Quotient': questionValues['A10'], // Fix for missing field warning
            'Qchat_10_Score': qChatTotal,
            'Age_Years': parseInt(document.getElementById('Age_Years').value) || 0,
            'Sex': parseInt(document.getElementById('Sex').value),
            'Ethnicity': parseInt(document.getElementById('Ethnicity').value),
            'Jaundice': parseInt(document.getElementById('Jaundice').value),
            'Family_mem_with_ASD': parseInt(document.getElementById('Family_mem_with_ASD').value),
            'Depression': parseInt(document.getElementById('Depression').value),
            'Anxiety_disorder': parseInt(document.getElementById('Anxiety_disorder').value),
            'Who_completed_the_test': parseInt(document.getElementById('Who_completed_the_test').value)
        };

        console.log("Sending Data:", formData);

        // 3. Send to Node Server (which proxies to Flask)
        try {
            const res = await axios.post('/predict', formData);
            
            resultDiv.classList.remove('bg-info-subtle', 'text-info-emphasis');
            resultDiv.classList.add('bg-success-subtle', 'text-success-emphasis');
            resultDiv.textContent = res.data.prediction;
            
        } catch (err) {
            console.error(err);
            resultDiv.classList.remove('bg-info-subtle', 'text-info-emphasis');
            resultDiv.classList.add('bg-danger-subtle', 'text-danger-emphasis');
            resultDiv.textContent = 'Error: ' + (err.response?.data?.error || err.message);
        }
    });
</script>
</body>
</html>
 -->





<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Autism Spectrum Prediction Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { background-color: #f4f7f6; }
        .card { border: none; border-radius: 0.8rem; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .live-data-card { background-color: #e9ecef; }
        .form-label { font-weight: 500; }
        #predictionResult { font-size: 1.1rem; font-weight: normal; text-align: left; white-space: pre-wrap; }
    </style>
</head>
<body>
<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="display-5">Autism Spectrum Prediction Dashboard</h1>
        <p class="lead">Answer the questionnaire to get a prediction from the model.</p>
    </div>

    <a class="btn btn-primary w-100 mt-4 p-3" href="http://localhost:8501" >Get Prediction from image</a>


    <div class="row g-4">
        <div class="col-lg-7">
            <div class="card">
                <div class="card-body p-4 p-md-5">
                    <h4 class="card-title mb-4">Screening Questionnaire</h4>
                    <form id="predictionForm">
                        <div class="row g-4">
                            
                            <div class="col-md-6"><label for="A1" class="form-label">A1: Child looks at you when called?</label><select id="A1" class="form-select"><option value="1">Yes</option><option value="0">No</option></select></div>
                            <div class="col-md-6"><label for="A2" class="form-label">A2: Easy to get eye contact?</label><select id="A2" class="form-select"><option value="1">Easy</option><option value="0">Difficult</option></select></div>
                            <div class="col-md-6"><label for="A5" class="form-label">A5: Child pretends (e.g., pretend play)?</label><select id="A5" class="form-select"><option value="1">Yes</option><option value="0">No</option></select></div>
                            <div class="col-md-6"><label for="A6" class="form-label">A6: Child follows your gaze?</label><select id="A6" class="form-select"><option value="1">Yes</option><option value="0">No</option></select></div>
                            <div class="col-md-6"><label for="A7" class="form-label">A7: Child tries to comfort you if upset?</label><select id="A7" class="form-select"><option value="1">Yes</option><option value="0">No</option></select></div>
                            <div class="col-md-6"><label for="A9" class="form-label">A9: Child brings objects to show you?</label><select id="A9" class="form-select"><option value="1">Yes</option><option value="0">No</option></select></div>
                            
                            <hr class="my-3">

                            <div class="col-md-6">
                                <label for="Sex" class="form-label">Sex</label>
                                <select id="Sex" class="form-select">
                                    <option value="m">Male</option>
                                    <option value="f">Female</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="Ethnicity" class="form-label">Ethnicity</label>
                                <select id="Ethnicity" class="form-select">
                                    <option value="White European">White European</option>
                                    <option value="Middle Eastern">Middle Eastern</option>
                                    <option value="Asian">Asian</option>
                                    <option value="Black">Black</option>
                                    <option value="Hispanic">Hispanic</option>
                                    <option value="South Asian">South Asian</option>
                                    <option value="Native Indian">Native Indian</option>
                                    <option value="Others">Others</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="Anxiety_disorder" class="form-label">Anxiety Disorder Present?</label>
                                <select id="Anxiety_disorder" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1">Yes</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="Social/Behavioural Issues" class="form-label">Repetitive Actions?</label>
                                <select id="Social/Behavioural Issues" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1">Yes</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mt-4 p-3">Get Prediction</button>
                    </form>
                    <div id="predictionResult" class="mt-4 p-3 rounded"></div>
                </div>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="card live-data-card">
                 <div class="card-body p-4">
                    <h4 class="card-title text-center mb-3">Live Sensor Feed</h4>
                    <div id="sensorStatus" class="text-center">Waiting for data...</div>
                    <hr>
                    <h5 class="text-center">Real-Time Behavioural Metrics</h5>
                    <div class="text-center my-3"><h6>Repetitive Motion Status:</h6><p id="repetitiveStatus" class="fs-4 fw-bold text-primary">--</p></div>
                    <div class="text-center"><h6>Overall Movement Energy:</h6><p id="movementEnergy" class="fs-4 fw-bold text-success">--</p></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    async function updateDashboard() {
        try {
            const res = await axios.get("/api/data");
            const data = res.data;
            if (data.length === 0) { return; }
            document.getElementById('sensorStatus').textContent = 'üü¢ Receiving Data';
            const latestData = data[data.length - 1];
            const isRepetitive = latestData.repetitive;
            document.getElementById('repetitiveStatus').textContent = isRepetitive ? 'YES' : 'NO';
            const { ax, ay, az } = latestData;
            const energy = Math.sqrt(ax*ax + ay*ay + az*az);
            document.getElementById('movementEnergy').textContent = energy > 25000 ? 'HIGH' : 'LOW';
        } catch (err) {
            document.getElementById('sensorStatus').textContent = 'üî¥ Connection Error';
        }
    }
    setInterval(updateDashboard, 2000);
    updateDashboard();


    document.getElementById('predictionForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const resultDiv = document.getElementById('predictionResult');
        resultDiv.textContent = '‚è≥ Getting prediction...';
        resultDiv.className = 'mt-4 p-3 rounded bg-info-subtle';


        const qChatFields = ['A1', 'A2', 'A5', 'A6', 'A7', 'A9'];
        let qChatScore = 0;
        for (const fieldId of qChatFields) {
            if (document.getElementById(fieldId).value === '0') {
                qChatScore++;
            }
        }

        const formData = {
            'Qchat_10_Score': qChatScore,
        
            'A1': document.getElementById('A1').value,
            'A2': document.getElementById('A2').value,
            'A5': document.getElementById('A5').value,
            'A6': document.getElementById('A6').value,
            'A7': document.getElementById('A7').value,
            'A9': document.getElementById('A9').value,
            'Sex': document.getElementById('Sex').value,
            'Ethnicity': document.getElementById('Ethnicity').value,
            'Anxiety_disorder': document.getElementById('Anxiety_disorder').value,
            'Social/Behavioural Issues': document.getElementById('Social/Behavioural Issues').value,
        };

        try {
            const res = await axios.post('/predict', formData);
            resultDiv.textContent = res.data.prediction;
            resultDiv.className = 'mt-4 p-3 rounded bg-success-subtle text-success-emphasis';
        } catch (err) {
            resultDiv.textContent = 'Error: Could not get a prediction.';
            resultDiv.className = 'mt-4 p-3 rounded bg-danger-subtle text-danger-emphasis';
        }
    });
</script>
</body>
</html>
 -->
